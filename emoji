//emoji表情字符识别
namespace emoji

var emojiSet = {
	0x23;
	0x2a;
	{0x30, 0x39};
	0xa9;
	0xae;
	0x200d;
	0x203c;
	0x2049;
	0x20e3;
	0x2122;
	0x2139;
	{0x2194, 0x2199};
	{0x21a9, 0x21aa};
	{0x231a, 0x231b};
	0x2328;
	0x2388;
	0x23cf;
	{0x23e9, 0x23f3};
	{0x23f8, 0x23fa};
	0x24c2;
	{0x25aa, 0x25ab};
	0x25b6;
	0x25c0;
	{0x25fb, 0x25fe};
	{0x2600, 0x2605};
	{0x2607, 0x2612};
	{0x2614, 0x2685};
	{0x2690, 0x2705};
	{0x2708, 0x2712};
	0x2714;
	0x2716;
	0x271d;
	0x2721;
	0x2728;
	{0x2733, 0x2734};
	0x2744;
	0x2747;
	0x274c;
	0x274e;
	{0x2753, 0x2755};
	0x2757;
	{0x2763, 0x2767};
	{0x2795, 0x2797};
	0x27a1;
	0x27b0;
	0x27bf;
	{0x2934, 0x2935};
	{0x2b05, 0x2b07};
	{0x2b1b, 0x2b1c};
	0x2b50;
	0x2b55;
	0x3030;
	0x303d;
	0x3297;
	0x3299;
	0xfe0f;
	{0x1f000, 0x1f0ff};
	{0x1f10d, 0x1f10f};
	0x1f12f;
	{0x1f16c, 0x1f171};
	{0x1f17e, 0x1f17f};
	0x1f18e;
	{0x1f191, 0x1f19a};
	{0x1f1ad, 0x1f1ff};
	{0x1f201, 0x1f20f};
	0x1f21a;
	0x1f22f;
	{0x1f232, 0x1f23a};
	{0x1f23c, 0x1f23f};
	{0x1f249, 0x1f53d};
	{0x1f546, 0x1f64f};
	{0x1f680, 0x1f6ff};
	{0x1f774, 0x1f77f};
	{0x1f7d5, 0x1f7ff};
	{0x1f80c, 0x1f80f};
	{0x1f848, 0x1f84f};
	{0x1f85a, 0x1f85f};
	{0x1f888, 0x1f88f};
	{0x1f8ae, 0x1f8ff};
	{0x1f90c, 0x1f93a};
	{0x1f93c, 0x1f945};
	{0x1f947, 0x1fffd};
	{0xe0020, 0xe007f};
}

emojiCheck = function(real){
	for(i=1;#emojiSet;1){
		if(type(emojiSet[i]) == type.number){
			if(emojiSet[i] == real) return true; 
		}
		else {
			var a, b = emojiSet[i][1], emojiSet[i][2]
			for(i=a;b;1){
				if(real == i) return true; 
			}
		}
	}
}

isContainEmoji = function(str){
	var p = //\\u(\w{4,4})
	var tab = {}
	var estr = ..string.escape(str)
	if(!estr) return;
	for m in ..string.gmatch(estr, p) {
	    ..table.push(tab, "0x"+m)
	}
	if(!#tab) return;
	for(i=1;#tab;1){
		var current = tonumber(tab[i])
		var real = current
		if(current >= 0xD800 and current <= 0xDBFF and tab[[i+1]]){
			var next = tonumber(tab[[i+1]])
			real = 0x10000+(current - 0xD800)*0x400 + (next - 0xDC00)
		}
		if(emojiCheck(real)) return ..string.fromCharCode(tostring(real, 16)); 
		
	}
}

replaceEmoji = function(str){
	while(true){
		var x = isContainEmoji(str)
		if(!x) return str;
		str = ..string.replace(str, x, "")
	}
}

/*
import console
var str = "💝💕💖💔💯👩🏽‍🤝‍👨🏾👩‍👩‍👧📱‍👧🐾🦉🦋⛵❄️🌈🏆🥇♦️"
console.dumpJson(replaceEmoji(str))

console.askYesNo("按Y键继续,按N键取消")
*/
